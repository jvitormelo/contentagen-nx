---
import {
   Card,
   CardHeader,
   CardTitle,
   CardDescription,
} from "@packages/ui/components/card";
import { Button } from "@packages/ui/components/button";
import { Check } from "@lucide/astro";
import { useTranslations } from "../i18n/utils";
import type { SupportedLng } from "@packages/localization";

interface Props {
   lang?: SupportedLng;
}

const { lang = "en" } = Astro.props;
const t = useTranslations(lang);

type ButtonVariant =
   | "outline"
   | "default"
   | "destructive"
   | "ghost"
   | "link"
   | "secondary";

interface PricingPlan {
   name: string;
   price: string;
   period: string;
   description: string;
   variant: ButtonVariant;
   popular?: boolean;
   features: string[];
}

const pricingPlans: PricingPlan[] = [
   {
      name: t("pages.landing.pricing.plans.free.name"),
      price: t("pages.landing.pricing.plans.free.price"),
      period: t("pages.landing.pricing.plans.free.period"),
      description: t("pages.landing.pricing.plans.free.description"),
      variant: "outline",
      features: [
         t("pages.landing.pricing.plans.free.features.credit"),
         t("pages.landing.pricing.plans.free.features.organization"),
         t("pages.landing.pricing.plans.free.features.api"),
         t("pages.landing.pricing.plans.free.features.support"),
         t("pages.landing.pricing.plans.free.features.noCard"),
         t("pages.landing.pricing.plans.free.features.coreFeatures"),
      ],
   },
   {
      name: t("pages.landing.pricing.plans.basic.name"),
      price: t("pages.landing.pricing.plans.basic.price"),
      period: t("pages.landing.pricing.plans.basic.period"),
      description: t("pages.landing.pricing.plans.basic.description"),
      variant: "default",
      popular: true,
      features: [
         t("pages.landing.pricing.plans.basic.features.credit"),
         t("pages.landing.pricing.plans.basic.features.payAsGo"),
         t("pages.landing.pricing.plans.basic.features.organization"),
         t("pages.landing.pricing.plans.basic.features.api"),
         t("pages.landing.pricing.plans.basic.features.support"),
         t("pages.landing.pricing.plans.basic.features.coreFeatures"),
      ],
   },
   {
      name: t("pages.landing.pricing.plans.supporter.name"),
      price: t("pages.landing.pricing.plans.supporter.price"),
      period: t("pages.landing.pricing.plans.supporter.period"),
      description: t("pages.landing.pricing.plans.supporter.description"),
      variant: "outline",
      features: [
         t("pages.landing.pricing.plans.supporter.features.credit"),
         t("pages.landing.pricing.plans.supporter.features.featureRequest"),
         t("pages.landing.pricing.plans.supporter.features.organization"),
         t("pages.landing.pricing.plans.supporter.features.api"),
         t("pages.landing.pricing.plans.supporter.features.support"),
         t("pages.landing.pricing.plans.supporter.features.coreFeatures"),
      ],
   },
];
---

<section id="pricing" class="min-h-screen relative py-16 md:py-24">
  <div class="mx-auto max-w-6xl px-6">
    <div class="mx-auto max-w-2xl text-center">
      <h2 class="text-balance text-2xl font-bold md:text-3xl lg:text-4xl">
        {t("pages.landing.pricing.title")}
      </h2>
      <p class="text-muted-foreground mx-auto mt-4 max-w-xl text-balance">
        {t("pages.landing.pricing.subtitle")}
      </p>
    </div>

    <div class="relative mt-12">
      <div class="grid gap-6 md:grid-cols-3">
        {pricingPlans.map((plan) => (
          <Card
            className={`relative flex flex-col ${plan.popular ? 'ring-2 ring-primary scale-105 shadow-xl' : 'shadow-lg'}`}
          >
            <CardHeader className="p-8">
              <div class="flex items-center justify-between">
                <CardTitle className="font-medium">{plan.name}</CardTitle>
                {plan.popular && (
                  <span class="bg-primary text-primary-foreground px-3 py-1 rounded-full text-xs font-medium">
                    {t("pages.landing.pricing.plans.basic.popular")}
                  </span>
                )}
              </div>
              <span class="mb-0.5 mt-2 block text-2xl font-semibold">
                {plan.price}<span class="text-sm font-normal text-muted-foreground">{plan.period}</span>
              </span>
              <CardDescription className="text-sm">{plan.description}</CardDescription>
            </CardHeader>

            <div class="border-y px-8 py-4">
              <a href="https://app.contentagen.com/auth/sign-in" target="_blank" rel="noopener noreferrer">
                <Button
                  className="w-full"
                  variant={plan.variant}
                  aria-label={`Get started with ${plan.name} plan at ${plan.price} per month`}
                >
                  {t("pages.landing.pricing.button")}
                </Button>
              </a>
            </div>

            <ul role="list" class="space-y-3 p-8 flex-1">
              {plan.features.map((feature) => (
                <li class="flex items-center gap-2">
                  <Check class="text-primary size-3" stroke-width="3.5" />
                  <span class="text-sm">{feature}</span>
                </li>
              ))}
            </ul>
          </Card>
        ))}
      </div>
    </div>
  </div>
</section>
